<!DOCTYPE html>

<html lang="fr">
<head>
<!--
    Ce fichier HTML fait partie du site d'Ana Ruiz.
    Structure, navigation, et fonctionnalités sont expliquées par des commentaires dans le code.
    Tout est responsive, accessible et moderne. Voir README.md pour plus de détails.
  -->
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>La maison ou le pouvoir de rentrer en soi-même (2012) - Ana Ruiz</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;700&amp;family=Playfair+Display:wght@700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&amp;display=swap" rel="stylesheet"/>
<link href="css/style-modern.css" rel="stylesheet"/>
<style>
    /* fallback : valeur par défaut pour éviter chevauchement si JS n'a pas encore calculé la hauteur */
    :root { --site-nav-offset: 80px; }
     body { background: #151516 !important; }
     .gallery-page {
       max-width: 1000px;
       margin: 0 auto 3rem auto;
       padding: 0 1vw;
       /* espace au-dessus calculé à partir de la hauteur réelle de la navbar */
       margin-top: calc(var(--site-nav-offset) + 0.8rem);
     }
    .gallery-title {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      margin-bottom: 0.5em;
      color: #f4efe9;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-align: center;
      line-height: 1.25;
    }
    .gallery-desc {
      color: #cec9c4;
      font-size: 1.09rem;
      margin: 0 auto 1.2rem auto; /* espace supplémentaire sous la phrase */
      max-width: 880px;           /* limite largeur et évite débordement */
      text-align: center;
      font-style: italic;
      cursor: pointer;
      position: relative;
      outline: none;
      display: block;             /* bloc plein, empêche chevauchement */
      padding: .45rem .9rem;
      border-radius: 10px;
      background: rgba(255,255,255,0.02);
      transition: background .18s, transform .12s;
      -webkit-appearance: none;
      text-decoration: none;
      line-height:1.3;
      touch-action: manipulation; /* priorité aux taps, évite gestures indésirables */
      -webkit-tap-highlight-color: transparent;
      z-index: 40; /* au-dessus d'éléments éventuels */
    }
    /* indicateur placé après le texte, non absolu (ne force pas débordement) */
    .gallery-desc::after {
      content: " ▾ En savoir plus";
      display: inline-block;
      margin-left: .45rem;
      font-size: 0.88rem;
      color: #bfb6ad;
      opacity: 0.95;
      pointer-events: none;
      white-space: nowrap;
    }
    /* petite amélioration visuelle pour montrer que c'est cliquable */
    .gallery-desc:hover,
    .gallery-desc:focus {
      background: rgba(255,255,255,0.045);
      transform: translateY(-1px);
      outline: 2px solid rgba(255,255,255,0.05);
    }
    /* si malgré tout il reste du texte posé sous la phrase, forcer séparation */
    .gallery-works { margin-top: 0.8rem; }

    /* Bloc étendu : fond, ombre et priorité d'affichage */
    .expanded-text {
      position: relative;
      z-index: 30;                    /* au-dessus des éléments fixes */
      background: rgba(20,20,22,0.96);/* fond opaque pour éviter superposition visuelle */
      border-radius: 12px;
      padding: 1rem .9rem;
      box-shadow: 0 8px 30px rgba(0,0,0,0.5);
      overflow: hidden;
      color: #d7d2cf;
      text-align: justify;
      margin: 0 auto;
      max-width: 780px;
      box-sizing: border-box;
      display: none;                  /* caché par défaut de façon sûre */
      opacity: 0;
      transform-origin: top center;
      transform: translateY(-6px);
      transition: opacity 0.26s ease, transform 0.26s ease;
    }
    .expanded-text.open {
      display: block;                 /* rendu visible quand on ouvre */
      opacity: 1;
      transform: translateY(0);
      margin-top: 1rem;
    }

    /* bouton Fermer */
    .expanded-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255,255,255,0.04);
      border: 0;
      color: #ece3de;
      padding: .18rem .5rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95rem;
      display: none;
    }
    .expanded-text.open .expanded-close { display: block; }
    .gallery-works {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 2em 2em;
      margin-bottom: 2em;
    }
    .gallery-work {
      background: rgba(38,37,41,0.12);
      border-radius: 16px;
      box-shadow: 0 2px 14px #19171b18;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow 0.16s;
    }
    .gallery-work img {
      width: 100%;
      height: 260px;
      object-fit: cover;
      background: #222226;
      display: block;
    }
    .gallery-work-title {
      margin: 1em 0 0.6em 0;
      color: #f4efe9;
      font-family: 'Playfair Display', serif;
      font-size: 1.09rem;
      font-weight: 700;
      letter-spacing: 0.2px;
      text-align: center;
    }
    .gallery-work-desc {
      color: #c7c7c7;
      font-size: 0.99rem;
      text-align: center;
      margin-bottom: 1em;
    }
    .gallery-citation {
      margin: 2.5em auto 1.5em auto;
      color: #a7a2b6;
      background: rgba(44,44,48,0.18);
      border-left: 3px solid #8b858c;
      font-style: italic;
      font-size: 1.07rem;
      padding: 1em 1.3em;
      max-width: 650px;
      border-radius: 10px;
      box-shadow: 0 2px 14px #19171b18;
    }
    .gallery-back {
      display: flex;
      justify-content: center;
      margin-top: 2.5em;
    }
    .gallery-back a {
      font-size: 1rem;
      color: #968a7f;
      text-decoration: none;
      background: rgba(238, 233, 222, 0.12);
      padding: 0.7em 1.5em;
      border-radius: 18px;
      transition: background 0.14s, color 0.14s;
      box-shadow: 0 2px 9px #18101421;
    }
    .gallery-back a:hover {
      background: rgba(238, 233, 222, 0.22);
      color: #b3a797;
    }
    @media (max-width: 600px) {
      .gallery-title { font-size: 1.3rem;}
      .gallery-works { grid-template-columns: 1fr;}
      .gallery-work img { height: 180px;}
    }

    /* Eviter que la barre chevauche le contenu : garde compatibilité */
-  .gallery-page { margin-top: calc(5rem + 0.8rem); } /* ajuste si nécessaire */
+  /* la variable CSS --site-nav-offset garantit que le contenu commence sous la navbar */
+  .gallery-page { margin-top: calc(var(--site-nav-offset) + 0.8rem); } /* ajustable si nécessaire */

    /* signature auteur : police manuscrite */
    .author-signature {
      font-family: "Great Vibes", cursive;
      font-size: 1.6rem;                 /* un peu plus grand pour la lisibilité */
      color: #e6dccf;
      display: inline-block;
      margin-top: .45rem;
      line-height: 1;
      letter-spacing: 0.8px;             /* espacement entre caractères */
      word-spacing: 0.5rem;              /* espace entre les mots/parties du nom */
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
    }
    .author-signature .sig-part { display:inline-block; }
    .author-signature .sig-sep { width:.5rem; display:inline-block; }

    /* Styles pour le texte étendu */
    .expanded-text p {
      text-align: justify;
      text-justify: inter-word;
      -webkit-hyphens: auto;
      -ms-hyphens: auto;
      hyphens: auto;
      margin: 0 0 1rem;
      line-height: 1.7;
      color: #d7d2cf;
      font-size: 1rem;
    }
    .expanded-text blockquote {
      font-style: italic;
      margin: 1rem 0;
      color: #e6dccf;
      border-left: 3px solid rgba(255,255,255,0.04);
      padding-left: 1rem;
    }
    .expanded-text .source {
      text-align: right;
      font-style: italic;
      color: #bfb6ad;
      margin-top: 0.6rem;
      font-size: 0.95rem;
    }
    @media (orientation: landscape) {
    }
  </style>

<style>
.nav-logo a {
  font-size: 1.05rem;
  font-weight: 700;
  white-space: nowrap;
}
.nav-signature { display:inline-block; margin-left:.4rem; height:22px; }

/* Navigation links (desktop) */
.nav-links {
  display: flex;
  gap: 1rem;
  margin-left: auto;
  align-items: center;
}
.nav-links a {
  display: inline-block;
  padding: .6rem .7rem;
  font-size: 0.98rem;
  line-height: 1;
  color: inherit;
  text-decoration: none;
  border-radius: .35rem;
}

/* visual breathing room for navbar on large screens */
@media (min-width: 1200px) {
  .navbar { padding: 1.2rem 0; }
  .nav-links a { padding: .7rem .9rem; font-size: 1rem; }
}

/* --- Mobile: adapter mais garder la barre plus haute proportionnellement --- */
@media (max-width: 840px){
  .navbar { padding: 0.8rem 0.6rem; }
  .navbar-container { gap: .6rem; padding: 0 0.6rem; }

  /* limiter la largeur du texte du logo mais le garder lisible */
  .nav-logo a {
    font-size: 0.88rem;
    font-weight:700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 160px;
    display: inline-block;
    vertical-align: middle;
  }

  /* signature réduite pour mobile */
  .nav-signature{display:block; height:18px; width:auto; margin-left:.25rem; opacity:.95}
  .nav-signature img{height:18px; width:auto; display:block; opacity:.95}

  /* hamburger un peu plus grand pour confort tactile */
  .hamburger{
    margin-left:auto;
    width:42px;
    height:36px;
    padding:0;
    display:grid;
    place-items:center;
    font-size:1rem;
    line-height:1;
    border-radius:.5rem;
  }

  /* Menu mobile: colonne, plein largeur mais discret */
  .nav-links{
    display:none;
    flex-direction:column;
    align-items:center;
    text-align:center;
    gap:0.12rem;
    padding:0.35rem 0;
    width:100%;
  }
  .nav-links.open{display:flex}

  .nav-links li { margin:0; width:100%; }
  .nav-links a{
    display:block;
    padding:.44rem 0;
    font-size:0.92rem;
    line-height:1.15;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    width:100%;
  }

  /* très petits écrans : compacter encore légèrement */
  @media (max-width: 380px) {
    .nav-logo a { max-width: 120px; font-size:0.8rem; }
    .nav-links a { font-size:0.82rem; padding:.28rem 0; }
    .hamburger { width:38px; height:32px; font-size:0.9rem; }
  }
}
</style></head>
<body>
<!-- ===== Barre de navigation principale ===== -->
<nav class="navbar">
<div class="navbar-container">
<div class="nav-logo">
<a href="index.html">Ana Ruiz</a>
<img alt="Signature Ana Ruiz" class="nav-signature" src="img/signature.png"/>
</div>
<button aria-label="Ouvrir le menu" class="hamburger" id="menu-toggle">☰</button>
<ul class="nav-links">
<li><a href="index.html">Accueil</a></li>
<li><a href="galeries.html">Galeries</a></li>
<li><a href="videos.html">Vidéos</a></li>
<li><a href="publications.html">Publications</a></li>
<li><a href="diaporama.html">Diaporama</a></li>
<li><a href="apropos.html">À propos</a></li>
<li><a href="contact.html">Contact</a></li>
</ul>
</div>
</nav>
<!-- ===== Contenu principal de la page ===== -->
<main>
<div class="gallery-page fade-in">
<div class="gallery-title">La maison ou le pouvoir de rentrer en soi-même (2012)</div>
<div aria-expanded="false" class="gallery-desc" id="gallery-desc" role="button" tabindex="0" title="Cliquer pour développer">
        La maison est-elle le reflet de notre personnalité qui se construit peu à peu au fil des ans ? Le geste transmis de génération en génération ? 
        Qui, de nous ou de la maison reflète l'autre ? Qui construit et protège l'autre ? 
        
      </div>
<!-- remplacer le contenu actuel de #gallery-desc-full par : -->
<div aria-hidden="true" class="expanded-text" id="gallery-desc-full">
<button aria-label="Fermer la description" class="expanded-close" id="gallery-desc-close">✕</button>
<p>
          Parce qu’elle est indissociablement matérielle et immatérielle — maison où l’on vit et maison que l’on porte au fond de soi — la maison nous habite autant que nous l’habitons. C’est pourquoi la perdre revient aussi à se perdre soi‑même : rester enfermé dehors et en dehors de soi, en exil, dépossédé de l’espace intime de vie et du pouvoir de rentrer en soi‑même, séparé de soi et des autres comme un fantôme hanté par la maison disparue.
        </p>
<p>
          Un vieux conte traditionnel nous enseigne comment, grâce à notre travail et pourvu que nous soyons prévoyants, nous n’aurons rien à craindre pour la sécurité de la maisonnée, car nous choisirons sagement entre la maison de paille et de ciment, capable de braver le souffle du loup qui peut aisément balayer la maison de paille et secouer fortement la maison de bois qu’elle finit par dégringoler. Mais le loup est devenu bien pire symbole des dangers qui menacent les foyers. Quelle sorte de maison pourra nous protéger, sans faillir, des tempêtes qui soufflent sur notre monde et qui, financièrement, précipitent dans la ruine des populations entières ? Le conte ne le dit pas.
        </p>
<p>
          Sur le fil qui relie entre elles toutes les maisons du monde avance opiniâtrement en vacillant une frêle silhouette. Serait‑ce un hidalgo funambule que la force d’un noble et généreux idéal empêche de tomber et pousse envers et contre tout à aller de l’avant ? Cherche‑t‑il, de maison en maison, une porte ouverte sur un autre monde où toute maison est le centre de l’univers et où aucune ne sera jamais détruite ? Nous marchons tous sur un fil et, de là‑haut, si nous regardons bien, si nous regardons penchés à la fenêtre du cœur,
        </p>
<p><em>Germinal Arcal Palacio</em></p>
<blockquote>
          « (…) toutes les maisons apparaissent comme des coques de bateaux joliment colorées sur la mer immense et bleue de l’univers. Fragiles, les petites voiles triangulaires et le mât pointé vers le ciel, elles disent en même temps notre enfermement et notre légèreté, notre gravité et notre vanité. »
        </blockquote>
<div class="source">(Lydia Devos, La Maison, Le Seuil)</div>
</div>
<div class="gallery-works">
<div class="gallery-work">
<img alt="Maison sacrée" data-large="img/la-maison/maison-sacree.jpg" src="img/la-maison/maison-sacree.jpg" tabindex="0"/>
<div class="gallery-work-title">Maison sacrée</div>
<div class="gallery-work-desc"></div>
</div>
<div class="gallery-work">
<img alt="Maison Floride" data-large="img/la-maison/maison-floride.jpg" src="img/la-maison/maison-floride.jpg" tabindex="0"/>
<div class="gallery-work-title">Maison Floride</div>
<div class="gallery-work-desc"></div>
</div>
<div class="gallery-work">
<img alt="Maison temple" data-large="img/maison-temple.jpg" src="img/maison-temple.jpg" tabindex="0"/>
<div class="gallery-work-title">Maison temple</div>
<div class="gallery-work-desc"></div>
</div>
<div class="gallery-work">
<img alt="Maison palais prison" data-large="img/maison-palais-prison.jpg" src="img/maison-palais-prison.jpg" tabindex="0"/>
<div class="gallery-work-title">Maison palais prison</div>
<div class="gallery-work-desc"></div>
</div>
<!-- Ajoute autant d’œuvres que dans la page initiale, en gardant cette structure -->
</div>
<div class="gallery-citation">
        « Rentrer dans la maison, c’est peut-être rentrer en soi-même… »
      </div>
<div class="gallery-back">
<a href="galeries.html">← Retour aux galeries</a>
</div>
</div>
</main>
<!-- ===== Pied de page commun à tout le site ===== -->
<footer>
<p>© 2025 Ana Ruiz. Tous droits réservés. | <a href="mentions-legales.html">Mentions légales</a></p>
</footer>

<!-- Lightbox unique -->
<style>
.fade-in{opacity:1!important;transform:none!important;}
.lb-overlay{
  position:fixed; inset:0;
  display:none;
  align-items:center; justify-content:center;
  background:#000;
  background:rgba(0,0,0,.94);
  z-index:5000;
  touch-action:none;
}
.lb-overlay.open{display:flex;}
.lb-inner{
  position:relative;
  width:100svw;
  height:100svh;
  max-width:100svw;
  max-height:100svh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  box-sizing:border-box;
}
#lb-img{
  max-width:100%;
  max-height:100%;
  width:auto;
  height:auto;
  object-fit:contain;
  margin:0;
  display:block;
  -webkit-user-select:none;
  user-select:none;
  pointer-events:auto;
}
#lb-close{
  position:fixed;
  top:calc(env(safe-area-inset-top) + 10px);
  right:calc(env(safe-area-inset-right) + 12px);
  background:rgba(255,255,255,.16);
  color:#fff;
  border:0;
  padding:.48rem .78rem;
  font-size:1rem;
  line-height:1;
  border-radius:32px;
  cursor:pointer;
  backdrop-filter:blur(4px);
}
#lb-close:hover,#lb-close:focus{background:rgba(255,255,255,.28);outline:none;}
body.lb-open{overflow:hidden;}
body.lb-open .navbar{transform:translateY(-130%);opacity:0;pointer-events:none;transition:.25s;}
@media (orientation:landscape){
  .lb-inner{width:100svw;height:100svh;}
  #lb-img{max-width:100%;max-height:100%;}
}
</style>
<div id="lightbox" class="lb-overlay" aria-hidden="true" role="dialog">
  <div class="lb-inner" role="document">
    <img id="lb-img" alt=""/>
    <button id="lb-close" type="button" aria-label="Fermer">×</button>
  </div>
</div>

<script>
(function(){
  const thumbs=document.querySelectorAll('.gallery-work img');
  if(!thumbs.length)return;
  const box=document.getElementById('lightbox'),
        img=document.getElementById('lb-img'),
        closeBtn=document.getElementById('lb-close');
  let lock=false, savedPad= '';

  function viewportDims(){
    if(window.visualViewport){
      return { w: window.visualViewport.width, h: window.visualViewport.height };
    }
    return { w: window.innerWidth, h: window.innerHeight };
  }

  function adjust(){
    if(!box.classList.contains('open')) return;
    const vp=viewportDims();
    img.style.maxWidth = vp.w + 'px';
    img.style.maxHeight = vp.h + 'px';
  }

  function open(src,alt){
    if(lock)return;
    savedPad = document.body.style.paddingTop || '';
    document.body.style.paddingTop = '0'; // retire l’offset navbar
    img.src=src; img.alt=alt||'';
    box.classList.add('open'); box.setAttribute('aria-hidden','false');
    document.body.classList.add('lb-open');
    closeBtn.focus();
    // petit délai pour laisser le viewport mobile se stabiliser
    setTimeout(adjust,50);
    setTimeout(adjust,250);
  }

  function close(){
    lock=true;
    box.classList.remove('open'); box.setAttribute('aria-hidden','true');
    document.body.classList.remove('lb-open');
    document.body.style.paddingTop = savedPad;
    setTimeout(()=>{ img.src=''; lock=false; },200);
  }

  thumbs.forEach(t=>{
    t.style.cursor='zoom-in';
    t.tabIndex = t.tabIndex || 0;
    const src = t.getAttribute('data-large')||t.src;
    function trigger(e){
      e.preventDefault();
      open(src, t.alt||'');
    }
    t.addEventListener('click', trigger);
    t.addEventListener('keydown', e=>{
      if(e.key==='Enter'||e.key===' '){ trigger(e); }
    });
    t.addEventListener('pointerdown', e=>{
      if(e.pointerType==='touch'){ trigger(e); }
    }, {passive:true});
  });

  closeBtn.addEventListener('click', e=>{ e.stopPropagation(); close(); });
  box.addEventListener('click', e=>{ if(e.target===box) close(); });
  document.addEventListener('keydown', e=>{
    if(e.key==='Escape'&&box.classList.contains('open')) close();
  });

  window.addEventListener('resize', adjust);
  window.addEventListener('orientationchange', ()=>setTimeout(adjust,160));
  if(window.visualViewport){
    visualViewport.addEventListener('resize', ()=>setTimeout(adjust,40));
  }
})();
</script>

<script>
  (function(){
    function updateNavOffset() {
      var nav=document.querySelector('.navbar');
      var offset=nav?Math.ceil(nav.getBoundingClientRect().height):80;
      document.documentElement.style.setProperty('--site-nav-offset', offset+'px');
      document.body.style.paddingTop=offset+'px';
    }
    var tries=0;
    function waitForNav(){
      if(document.querySelector('.navbar')){ updateNavOffset(); return; }
      if(++tries<40) setTimeout(waitForNav,50); else updateNavOffset();
    }
    if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', waitForNav);
    else waitForNav();
    window.addEventListener('resize', ()=>setTimeout(updateNavOffset,80));
    window.addEventListener('load', ()=>setTimeout(updateNavOffset,120));
  })();
</script>
<style>
/* === Lightbox responsive + script description === */
:root { --vvh: 100vh; } /* sera recalculé par JS */
.lightbox-overlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.94);
  z-index: 7000;
  touch-action: none;
}
.lightbox-overlay.open { display: flex; }
.lightbox-inner {
  width: var(--vvw);
  height: var(--vvh);
  max-width: var(--vvw);
  max-height: var(--vvh);
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  overflow: hidden;
}
#lightbox-img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  display: block;
  -webkit-user-select: none;
  user-select: none;
  margin: 0;
}
#lightbox-close {
  position: fixed;
  top: calc(env(safe-area-inset-top,0px) + 10px);
  right: calc(env(safe-area-inset-right,0px) + 12px);
  background: rgba(255,255,255,.25);
  color:#fff;
  border:0;
  padding:.5rem .82rem;
  font-size:1rem;
  line-height:1;
  border-radius:32px;
  cursor:pointer;
  backdrop-filter:blur(5px);
  z-index:7100;
}
#lightbox-close:hover,#lightbox-close:focus { background: rgba(255,255,255,.38); outline:none; }

/* Assurer que le déclencheur "En savoir plus" est toujours au-dessus du flux normal (et cliquable) */
.gallery-desc { z-index: 20; position: relative; }
.expanded-text { z-index: 30; }

/* paysage : ne pas figer la taille, laisser JS recalculer */
@media (orientation: landscape) {
  .lightbox-inner { width: var(--vvw); height: var(--vvh); }
}
</style>
<!-- (ne duplique pas div lightbox si déjà présent; si doublon présent, conserver UNE seule instance) -->
<div id="lightbox" class="lightbox-overlay" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="lightbox-inner">
    <img id="lightbox-img" alt="">
    <button id="lightbox-close" aria-label="Fermer plein écran">✕</button>
  </div>
</div>

<script>
/* Script description (En savoir plus) rétabli / robuste */
(function(){
  const trigger = document.getElementById('gallery-desc');
  const panel   = document.getElementById('gallery-desc-full');
  const closeB  = document.getElementById('gallery-desc-close');
  if(!trigger || !panel) return;

  function openDesc(){
    panel.style.display='block';
    requestAnimationFrame(()=>{
      panel.classList.add('open');
      panel.setAttribute('aria-hidden','false');
      trigger.setAttribute('aria-expanded','true');
      if (closeB) closeB.focus();
    });
  }
  function closeDesc(){
    panel.classList.remove('open');
    panel.setAttribute('aria-hidden','true');
    trigger.setAttribute('aria-expanded','false');
    setTimeout(()=>{ panel.style.display='none'; trigger.focus(); },220);
  }
  function toggle(){ panel.classList.contains('open') ? closeDesc() : openDesc(); }

  // Clic desktop & mobile
  trigger.addEventListener('click', function(e){
    toggle();
  });

  // Clavier
  trigger.addEventListener('keydown', function(e){
    if(e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      toggle();
    }
  });

  // Bouton fermer
  if(closeB){
    closeB.addEventListener('click', function(e){
      e.stopPropagation();
      closeDesc();
    });
    closeB.addEventListener('keydown', function(e){
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        closeDesc();
      }
    });
  }
})();
</script>

<script>
/* Lightbox plein écran: calcul fiable viewport (iOS paysage avec visualViewport) */
(function(){
  const thumbs = document.querySelectorAll('.gallery-work img');
  if(!thumbs.length) return;
  const box = document.getElementById('lightbox');
  const img = document.getElementById('lightbox-img');
  const closeBtn = document.getElementById('lightbox-close');
  let lock=false, savedPad='';

  function setViewportVars(){
    const vw = window.visualViewport ? window.visualViewport.width : window.innerWidth;
    const vh = window.visualViewport ? window.visualViewport.height : window.innerHeight;
    document.documentElement.style.setProperty('--vvw', vw + 'px');
    document.documentElement.style.setProperty('--vvh', vh + 'px');
  }

  function hideIOSBars(){
    // petit scroll pour forcer la réduction de la barre d'adresse sur iOS en paysage
    window.scrollTo(0,1);
  }

  function open(src, alt){
    if(lock) return;
    savedPad = document.body.style.paddingTop || '';
    document.body.style.paddingTop='0';
    img.src=src; img.alt=alt||'';
    setViewportVars();
    box.classList.add('open');
    box.setAttribute('aria-hidden','false');
    document.body.classList.add('lb-open');
    hideIOSBars();
    closeBtn.focus();
    // recalculs différés (UI iOS se réajuste après animation)
    setTimeout(()=>{ setViewportVars(); hideIOSBars(); },120);
    setTimeout(setViewportVars,400);
  }

  function close(){
    lock=true;
    box.classList.remove('open');
    box.setAttribute('aria-hidden','true');
    document.body.classList.remove('lb-open');
    document.body.style.paddingTop = savedPad;
    setTimeout(()=>{ img.src=''; lock=false; },180);
  }

  thumbs.forEach(t=>{
    t.style.cursor='zoom-in';
    if(!t.hasAttribute('tabindex')) t.tabIndex=0;
    const src = t.getAttribute('data-large') || t.src;
    function trigger(e){ e.preventDefault(); open(src, t.alt||''); }
    t.addEventListener('click', trigger);
    t.addEventListener('pointerdown', e=>{ if(e.pointerType==='touch') trigger(e); }, {passive:true});
    t.addEventListener('keydown', e=>{
      if(e.key==='Enter'||e.key===' ') trigger(e);
    });
  });

  closeBtn.addEventListener('click', e=>{ e.stopPropagation(); close(); });
  box.addEventListener('click', e=>{ if(e.target===box) close(); });
  document.addEventListener('keydown', e=>{
    if(e.key==='Escape' && box.classList.contains('open')) close();
  });

  // Mise à jour viewport
  function refreshIfOpen(){
    if(box.classList.contains('open')){
      setViewportVars();
    }
  }
  window.addEventListener('resize', ()=> setTimeout(refreshIfOpen,60));
  window.addEventListener('orientationchange', ()=> setTimeout(()=>{ refreshIfOpen(); hideIOSBars(); },180));
  if(window.visualViewport){
    visualViewport.addEventListener('resize', ()=> setTimeout(refreshIfOpen,40));
  }
})();
</script>

<style>
/* Lightbox minimal */
.lightbox-overlay {
  position:fixed; inset:0; display:none;
  align-items:center; justify-content:center;
  background:rgba(0,0,0,.92); z-index:6000;
}
.lightbox-overlay.open { display:flex; }
.lightbox-inner {
  width:100vw; height:100vh; max-width:100vw; max-height:100vh;
  display:flex; align-items:center; justify-content:center;
  padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  box-sizing:border-box;
}
#lightbox-img {
  max-width:100%; max-height:100%;
  width:auto; height:auto; object-fit:contain;
  -webkit-user-select:none; user-select:none;
}
#lightbox-close {
  position:fixed; top:calc(env(safe-area-inset-top,0px) + 10px);
  right:calc(env(safe-area-inset-right,0px) + 12px);
  background:rgba(255,255,255,.25); color:#fff; border:0;
  padding:.5rem .82rem; font-size:1rem; line-height:1;
  border-radius:32px; cursor:pointer; backdrop-filter:blur(4px); z-index:6100;
}
#lightbox-close:hover,#lightbox-close:focus { background:rgba(255,255,255,.38); outline:none; }
body.lb-open { overflow:hidden; }
body.lb-open .navbar { transform:translateY(-130%); opacity:0; pointer-events:none; transition:.25s; }

/* Bouton + fixe sur chaque vignette */
.gallery-work { position:relative; }
.gallery-work .zoom-btn {
  position:absolute; top:8px; right:8px;
  background:rgba(0,0,0,.55); color:#fff; border:0;
  padding:.38rem .6rem; font-size:.85rem; line-height:1;
  border-radius:6px; cursor:pointer; opacity:.85;
}
.gallery-work .zoom-btn:hover,.gallery-work .zoom-btn:focus{opacity:1;}
</style>

<!-- Lightbox HTML unique -->
<div id="lightbox" class="lightbox-overlay" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="lightbox-inner">
    <img id="lightbox-img" alt="">
    <button id="lightbox-close" aria-label="Fermer plein écran">✕</button>
  </div>
</div>

<script>
/* Injection des boutons + (si pas déjà ajoutés) et gestion Lightbox */
(function(){
  const works = document.querySelectorAll('.gallery-work');
  const box = document.getElementById('lightbox');
  const img = document.getElementById('lightbox-img');
  const closeBtn = document.getElementById('lightbox-close');
  let lock=false, savedPad='';

  // Nettoyage: supprimer doublons éventuels (si restés)
  document.querySelectorAll('div#lightbox:not(:last-of-type)').forEach(d=>d.remove());

  // Retirer anciens listeners sur images
  document.querySelectorAll('.gallery-work img').forEach(i=>{
    const clone=i.cloneNode(true);
    i.parentNode.replaceChild(clone,i);
  });

  // Ajouter boutons +
  document.querySelectorAll('.gallery-work').forEach(w=>{
    const pic=w.querySelector('img');
    if(!pic || w.querySelector('.zoom-btn')) return;
    const b=document.createElement('button');
    b.type='button'; b.className='zoom-btn'; b.textContent='+';
    b.addEventListener('click', e=>{
      e.stopPropagation();
      open(pic.getAttribute('data-large')||pic.src, pic.alt||'');
    });
    w.appendChild(b);
  });

  function setViewport(){
    // Ajustement iOS paysage
    const vw = window.visualViewport ? window.visualViewport.width : window.innerWidth;
    const vh = window.visualViewport ? window.visualViewport.height : window.innerHeight;
    box.style.setProperty('--vw', vw+'px');
    box.style.setProperty('--vh', vh+'px');
  }

  function open(src, alt){
    if(lock) return;
    savedPad = document.body.style.paddingTop || '';
    document.body.style.paddingTop='0';
    img.classList.remove('loaded');
    img.removeAttribute('style');
    img.onload=function(){
      img.classList.add('loaded');
    };
    img.onerror=function(){
      console.warn('Image introuvable:', src);
      close(); alert('Image non trouvée: '+src);
    };
    img.src=src; img.alt=alt||'';
    setViewport();
    box.classList.add('open');
    box.setAttribute('aria-hidden','false');
    document.body.classList.add('lb-open');
    closeBtn.focus();
    setTimeout(setViewport,120);
  }

  function close(){
    lock=true;
    box.classList.remove('open');
    box.setAttribute('aria-hidden','true');
    document.body.classList.remove('lb-open');
    document.body.style.paddingTop=savedPad;
    setTimeout(()=>{ img.src=''; lock=false; },160);
  }

  closeBtn.addEventListener('click', e=>{ e.stopPropagation(); close(); });
  box.addEventListener('click', e=>{ if(e.target===box) close(); });
  document.addEventListener('keydown', e=>{
    if(e.key==='Escape' && box.classList.contains('open')) close();
  });
  window.addEventListener('resize', ()=>{ if(box.classList.contains('open')) setTimeout(setViewport,60); });
  window.addEventListener('orientationchange', ()=>{ if(box.classList.contains('open')) setTimeout(setViewport,160); });
  if(window.visualViewport){
    visualViewport.addEventListener('resize', ()=>{ if(box.classList.contains('open')) setTimeout(setViewport,40); });
  }
})();
</script>
</body>
</html>
